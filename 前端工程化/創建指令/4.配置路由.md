
```bash
npm i react-router-dom

mkdir -p src/router 
mkdir -p src/router/LazyLoad
mkdir -p src/views 

echo "import { env } from '@/api/env'

const Home = () => {
  return (
    <button
      onClick={() => {
        env(import.meta.env)
          .then((res) => {
            console.log(res.data)
          })
          .catch((err) => {
            console.error(err)
          })
      }}
      className=\"shadow-md font-bold underline \"
    >
      Hello world!
    </button>
  )
}

export default Home" > src/views/page.tsx

echo "import { Outlet } from 'react-router-dom'
import { useNavigate } from 'react-router-dom'

const Layout = () => {
  const navigate = useNavigate()
  return (
    <section className=\"flex h-screen\">
      <aside className=\"w-64 bg-gray-200\">
        <div className=\"flex flex-col items-center gap-2\">aside</div>
      </aside>
      <section className=\"flex-1 flex flex-col\">
        <header className=\"h-16 bg-blue-200 flex gap-2 items-center\">
          <div>header</div>
          <div>
            <button
              onClick={() => navigate(-1)}
              className=\"p-2 bg-gradient-to-r from-indigo-600 to-purple-800 text-white font-semibold rounded-lg shadow-md hover:opacity-75 transition duration-300 ease-in-out\"
            >
              上一頁
            </button>
          </div>
        </header>
        <main className=\"p-4 max-h-screen overflow-y-auto\">
          <Outlet />
        </main>
      </section>
    </section>
  )
}

export default Layout" > src/views/layout.tsx




echo '@keyframes loader-anim {
  0% {
    width: 0%;
  }

  100% {
    width: 100%;
  }
}

.animateLoader {
  animation: loader-anim 2s infinite;
}' > src/router/LazyLoad/loader.module.scss

echo "import React, { Suspense } from 'react'
import clsx from 'clsx'
import styles from './loader.module.scss'
export default function LazyLoad(
  ComponentPromise: Promise<{ default: React.ComponentType<object> }>
) {
  const LazyComponent = React.lazy(() => ComponentPromise)

  return (
    <Suspense fallback={<Loader />}>
      <LazyComponent />
    </Suspense>
  )
}

function Loader() {
  return (
    <div className=\"fixed top-0 left-0 w-full h-1  bg-gray-400\">
      <div
        className={clsx(
          'h-full bg-gradient-to-r from-green-500 to-blue-500',
          styles.animateLoader
        )}
      ></div>
    </div>
  )
}" > src/router/LazyLoad/LazyLoad.tsx

echo "import { useRoutes } from 'react-router-dom'
import { BrowserRouter } from 'react-router-dom'

import router from '@/router/router'
const Routes = () => {
  const routes = useRoutes(router)
  return routes
}

function App() {
  return (
    <BrowserRouter>
      <Routes />
    </BrowserRouter>
  )
}

export default App" > src/App.tsx

npm set-script route "node ./src/lib/createRouter.js"


echo '/* eslint-disable @typescript-eslint/no-var-requires */
const fs = require("fs")
const path = require("path")
function findClosestLayout(directory) {
  const files = fs.readdirSync(directory)
  const hasLayout = files.includes("layout.tsx")
  if (hasLayout) {
    return path.join(directory, "layout.tsx")
  }
  const parentDirectory = path.dirname(directory)
  if (parentDirectory === directory || !directory.includes("views")) {
    return null
  }
  return findClosestLayout(parentDirectory)
}
let arr = []
function printDirectoryContents(directory, parentPath = "/") {
  const files = fs.readdirSync(directory)
  const hasLayout = files.includes("layout.tsx")
  const hasPage = files.includes("page.tsx")
  const closestLayout = findClosestLayout(directory)
  for (const file of files) {
    const filePath = path.join(directory, file)
    const stat = fs.statSync(filePath)
    if (stat.isDirectory()) {
      const folderPath = path.join(parentPath, file)
      printDirectoryContents(filePath, folderPath)
    } else {
      if (!hasLayout && !hasPage) return
      const filePath = path
        .join(parentPath, file)
        .replace(/\\/g, "/")
        .replace(".tsx", "")
	  if (!filePath.endsWith("page") && !filePath.endsWith("layout")) continue
      const routePathRegex = /\/\([^)]*\)/g
      const paramsRegex = /\[(\w+)\]/g
      const routePath =
        filePath
          .replace(routePathRegex, "")
          .replace(paramsRegex, ":$1")
          .replace(/\/(?:page|layout)/g, "") || "/"
      const isLayout = filePath.endsWith("layout")
      const item = {
        routePath,
        filePath,
        isLayout,
        closestLayout: closestLayout
          ? closestLayout
              .replace(path.join(__dirname, "../views"), "")
              .replace(/\\/g, "/")
              .replace(".tsx", "")
          : null,
      }
      if (routePath === "/404") {
        item.routePath = "/*"
        item.closestLayout = null
      }
      arr = [...arr, item]
    }
  }
}
const viewsDirectory = path.join(__dirname, "../views")
printDirectoryContents(viewsDirectory)
arr.sort((a, b) => {
  if (a.filePath === a.closestLayout && b.filePath !== b.closestLayout) {
    return -1
  } else if (a.filePath !== a.closestLayout && b.filePath === b.closestLayout) {
    return 1
  } else {
    return a.routePath.localeCompare(b.routePath)
  }
})
const map = {}
function parentKey(filePath, obj) {
  const keys = Object.keys(obj)
  for (let key of keys) {
    if (key === filePath) continue
    if (filePath.includes(key)) {
      return key
    }
  }
  return false
}
const result = arr.reduce((acc, cur) => {
  const { routePath, filePath, closestLayout, isLayout } = cur
  const item = {
    path: routePath === "/" ? "" : routePath,
    element: `LazyLoad(import('\''@/views${filePath}'\''))`,
  }
  const condition = {
    isLayout: {
      true: () => {
        map[filePath] = {
          ...item,
          children: [],
        }
        const key = parentKey(filePath, map)
        if (key) {
          map[key].children.push(map[filePath])
        } else {
          acc = [...acc, map[filePath]]
        }
      },
      false: () => {
        if (!closestLayout) {
          map[routePath] = item
          acc = [...acc, map[routePath]]
        } else {
          map[closestLayout].children.push(item)
        }
      },
    },
  }
  condition.isLayout[isLayout]()
  return acc
}, [])
const output = `import LazyLoad from "./LazyLoad/LazyLoad"
const router = ${JSON.stringify(result, null, 2).replace(
/"LazyLoad\(.*?\)"/g,
  (match) => match.replace(/"/g, "")
)}
export default router
`
const targetFile = "../router/router.tsx"
const targetPath = path.resolve(__dirname, targetFile)
fs.writeFileSync(targetPath, output)' > src/lib/createRouter.js

npm run route

```

element: `LazyLoad(import('\''@/views${filePath}'\''))`,